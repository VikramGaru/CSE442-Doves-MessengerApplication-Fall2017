
 <!-- @Author  Tian Qinxin and Jiewei Shen and Tushar 

<!DOCTYPE html>
<html>

 <!-- Referenced from  https://www.youtube.com/watch?v=QISU14OrRbI&list=PLfdtiltiRHWHZh8C2G0xNRbcf0uyYzzK_  -->
<!-- Referenced from  https://www.youtube.com/watch?v=tHbCkikFfDE -->
<!-- referenced from  https://www.google.com/search?q=sky.jpg&source=lnms&tbm=isch&sa=X&ved=0ahUKEwiQkKr3_uLWAhXG1IMKHUZXCw4Q_AUICigB&biw=1366&bih=662#imgrc=NrSVH9jl6j-QcM: -->


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Welcome To Doves Messenger</title>
    <link rel="stylesheet" href="">
    <script language="JavaScript" src="http://code.jquery.com/jquery-1.11.0.js"></script>
    <script type="text/javascript">
    </script>
   <style>
   body {
       background-image:url("sky.jpg");

}


   </style>

</head>
<style type="text/css" media="screen">
div {
    border: 1px solid #cccccc;
    width: 3000px;
    min-height: 200px;
    overflow:scroll;
    float:middle;
    . {padding: 14px 40px;}
}
div {
    width: 600px;
    height: 30px;
    padding: 15px;
    background-color: yellow;
    box-shadow: 10px 0px;
}

</style>

<body>
    <div id="show">
    </div>
    <label id="email">abc</label> 
    <input type="text" id="message" name="" value="enter text here" placeholder="" onfocus="if (this.value == 'enter text here') {this.value=''}" >  
<!--
     <input type="text" id="peername" value="" placeholder="peernickname"> 
-->
        
      <!-- <a href="javascript:void(0)" onclick="send()">send</a> --> 
    
    <button type="submit" class="btn btn-primary btn-block" onclick="send()">send</button> 
    <!--<a href="javascript:void(0)" onclick="exit()">exit</a>  -->

</body>
<script type="text/javascript">
//I commented this to fix the bug of the "security hole" issue # 66(https://github.com/VikramGaru/DovesMessenger/issues/66)

//$('document').ready(function(){
//   var email=document.getElementById("email").value;
//   getQueryVariable(email);
//});

//from: https://stackoverflow.com/questions/2090551/parse-query-string-in-javascript

function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        if (decodeURIComponent(pair[0]) == variable) {
            return decodeURIComponent(pair[1]);
        }
    }
    //Make a request.
    console.log('Query variable %s not found', variable);
}
//Below is implemented by Qinxin Tian and Jiewei Shen.
//Commented by Qinxin Tian.
//https://www.speedguide.net/port.php?port=12345
//commonly chosen for the default port.
/*This simple example creates a new WebSocket, connecting to the server at ws://104.131.3.139 on port number 12345.*/
var ws = new WebSocket("ws://104.131.3.139:12345");

//This method level annotation can be used to decorate a Java method that wishes to be called when a new web socket session is open.
ws.onopen = function() {
    //$("#show").html("conn state: " + ws.readyState + "</br>");
      $("#show").html("<i>websocket connection is successful</i>" + "</br>");
//    ws.open("start");
    ws.send(getQueryVariable("secret"));
};

ws.onmessage = function(info) {
    $("#show").append(info.data + "</br>");
};

ws.onclose = function(info) {
    console.log("ws.onclose!");
    console.log(info);
    //redirect
    window.location.replace('login.html');
};
ws.onerror = function(info) {
    console.log("ws.onerror!");
};

function send() {
    var msg2snd      = $("#message").val();
    //Get the combined text contents of each element in the set of matched elements, including their descendants, or set the text contents of the matched
    //elements.
    var myname       = $("#email").text();
    var peername     = $("#email").text();
    //var str = "{name:'" + myname + "',peername:'" + peername + "',msg:'" + msg2snd + "'}";
     var str = "{name:'" + myname + "',peername:'" + peername + "',msg:'" + msg2snd + "'}";
    ws.send(str); 
};

function exit() {
    var r = ws.close();
    console.log("exit", r);
}

</script>

</html>



